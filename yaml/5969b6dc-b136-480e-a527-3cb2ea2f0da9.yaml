Id: 5969b6dc-b136-480e-a527-3cb2ea2f0da9
Author: Guus Verbeek
Created: '2023-01-09'
MitreID: T1068
Category: vulnerable driver
Verified: 'TRUE'
Commands:
  Command: sc.exe create hw_sys binPath=C:\windows\temp\hw.sys type=kernel && sc.exe
    start hw.sys
  Description: ''
  Usecase: Elevate privileges
  Privileges: kernel
  OperatingSystem: Windows 10
Resources:
- https://learn.microsoft.com/en-us/windows/security/threat-protection/windows-defender-application-control/microsoft-recommended-driver-block-rules
- https://decoded.avast.io/janvojtesek/the-return-of-candiru-zero-days-in-the-middle-east/
- https://www.virustotal.com/gui/file/6a4875ae86131a594019dec4abd46ac6ba47e57a88287b814d07d929858fe3e5/detection
Acknowledgement:
  Person: ''
  Handle: ''
Detection: []
KnownVulnerableSamples:
- Filename: hw.sys
  MD5: 3247014ba35d406475311a2eab0c4657
  SHA1: 74e4e3006b644392f5fcea4a9bae1d9d84714b57
  SHA256: 4880f40f2e557cff38100620b9aa1a3a753cb693af16cd3d95841583edcb57a8
  Signature:
  - Marvin Test Solutions, Inc.
  - GlobalSign Extended Validation CodeSigning CA - SHA256 - G3
  - GlobalSign
  - GlobalSign Root CA - R1
  Date: ''
  Publisher: ''
  Company: Marvin Test Solutions, Inc.
  Description: HW - Windows NT-10 (32/64 bit) kernel mode driver for PC ports/memory/PCI
    access
  Product: HW
  ProductVersion: 4.9.8.0
  FileVersion: 4.9.8.0
  MachineType: I386
  OriginalFilename: HW.sys
  Authentihash:
    MD5: 6eafc9b68f2047adf6879e955d3b69e8
    SHA1: 8a6d85617bc601b818ddf1b8e8d5db6cf7ae31c1
    SHA256: 615a7c647eba3f2dcea463d5705d5d59ca70b4250f895ad20ce6876076a8fa28
  InternalName: Hw.sys
  Copyright: "Copyright \xA9 1996-2021 Marvin Test Solutions, Inc. All Rights Reserved."
  Imports:
  - ntoskrnl.exe
  - HAL.dll
  ExportedFunctions: ''
  ImportedFunctions:
  - KeReleaseMutex
  - KeWaitForSingleObject
  - PsGetCurrentProcessId
  - KeInitializeDpc
  - MmGetSystemRoutineAddress
  - IoDeleteDevice
  - IoCreateSymbolicLink
  - KeInitializeMutex
  - IoCreateDevice
  - IoDeleteSymbolicLink
  - memcpy
  - PsGetVersion
  - ZwUnmapViewOfSection
  - ZwMapViewOfSection
  - ObReferenceObjectByHandle
  - ZwOpenSection
  - IoFreeMdl
  - MmMapLockedPages
  - MmBuildMdlForNonPagedPool
  - IoAllocateMdl
  - MmMapIoSpace
  - MmUnmapLockedPages
  - MmUnmapIoSpace
  - IoGetDmaAdapter
  - IofCallDriver
  - IoBuildSynchronousFsdRequest
  - ZwOpenProcess
  - KeInitializeEvent
  - ObfDereferenceObject
  - ExAllocatePoolWithTag
  - ObReferenceObjectByName
  - IoDriverObjectType
  - IofCompleteRequest
  - WRITE_REGISTER_BUFFER_ULONG
  - WRITE_REGISTER_BUFFER_USHORT
  - WRITE_REGISTER_BUFFER_UCHAR
  - WRITE_REGISTER_ULONG
  - WRITE_REGISTER_USHORT
  - WRITE_REGISTER_UCHAR
  - READ_REGISTER_BUFFER_ULONG
  - READ_REGISTER_BUFFER_USHORT
  - READ_REGISTER_BUFFER_UCHAR
  - READ_REGISTER_ULONG
  - READ_REGISTER_USHORT
  - READ_REGISTER_UCHAR
  - IoConnectInterrupt
  - IoDisconnectInterrupt
  - KeReleaseInterruptSpinLock
  - KeAcquireInterruptSpinLock
  - ExEventObjectType
  - KeDelayExecutionThread
  - KeInsertQueueDpc
  - ZwClose
  - KeSetEvent
  - IoCreateNotificationEvent
  - KeClearEvent
  - RtlQueryRegistryValues
  - RtlAppendUnicodeStringToString
  - RtlInitUnicodeString
  - memset
  - ExFreePoolWithTag
  - IoGetDeviceProperty
  - ExAllocatePool
  - READ_PORT_UCHAR
  - READ_PORT_USHORT
  - READ_PORT_ULONG
  - READ_PORT_BUFFER_UCHAR
  - READ_PORT_BUFFER_USHORT
  - READ_PORT_BUFFER_ULONG
  - WRITE_PORT_UCHAR
  - WRITE_PORT_USHORT
  - WRITE_PORT_ULONG
  - WRITE_PORT_BUFFER_UCHAR
  - WRITE_PORT_BUFFER_USHORT
  - WRITE_PORT_BUFFER_ULONG
  - HalAssignSlotResources
  - HalTranslateBusAddress
  - HalGetBusDataByOffset
  - HalGetInterruptVector
  Signatures:
  - CertificatesInfo: ''
    SignerInfo: ''
    Certificates:
    - Subject: OU=GlobalSign Root CA , R3, O=GlobalSign, CN=GlobalSign
      ValidFrom: '2018-09-19 00:00:00'
      ValidTo: '2028-01-28 12:00:00'
      Signature: 2370e9cfe2bef559ae94426fc44333aacd3f3ab96417f262064b48f140880617a1feabd15f3cc633f2f38edd1f1d3ecc1a6099820bacc7fc7e9a872aa57d0fa657eeac3b6a85d6debd4063f8ada6c888b012fcf641df0f09971e38ea539fbe05f43eead39f501276be098bc20b487d1e2e51f68d53d3ab1f401b8a8eed7dfb4f7956705f0cd38e1bb3a7700d372b9795abdae0126b1c40cec5c77eedc26258ec77ed7322c28af5864388adea136efdd8fe422fb97d5ead18ef9490ca3d27ab26949975c7cbd37bf7ca4cd3af5121925b847d2b9f153f74cb51e89e830e166f1be746ce23bdf9e4a28bd2396baa791c912ce261242d8e2a487090c41ec5e8e070
      SignatureAlgorithmOID: 1.2.840.113549.1.1.11
    - Subject: C=BE, O=GlobalSign nv,sa, CN=GlobalSign Extended Validation CodeSigning
        CA , SHA256 , G3
      ValidFrom: '2016-06-15 00:00:00'
      ValidTo: '2024-06-15 00:00:00'
      Signature: 7609c4cc2fd9ef1e4ba9f857f3403921ca4c3c1d9e292b20d42b44d288ce1a0d05cf8381bbeb69bc318d2ac4c744cc6060941ccfa1e102240ead5bbe2cc2271e67b7e8281f3251e339f398dfb89f2e8b2ab47b0a03bcbd36048fc9d09c4fa3022799b0f045e934dfe43aa3b70637d86f2a7990d4d44e5871ec53a96198f73969e0129c575872862729a51de532f32b99975abf2bb03cb406ea0e64ecb7cd65802417c2d937f5b1261035477b9a02ba54a24593ff79bf1a8cc59fb59fdf78e76b50f14794694b24b8da05e80c9d4f06ec4a31207e4f5d86842f35a3cd9cc184571f1fadc0e2a4b1ef296b2197a6d4feed0337b0fcf58d2abcdc8483e3dec3e75f
      SignatureAlgorithmOID: 1.2.840.113549.1.1.11
    - Subject: ??=Private Organization, serialNumber=2147696, ??=US, ??=DELAWARE,
        C=US, ST=CA, L=Irvine, ??=1770 Kettering, O=Marvin Test Solutions, Inc., CN=Marvin
        Test Solutions, Inc.
      ValidFrom: '2019-07-29 13:20:49'
      ValidTo: '2022-07-29 13:20:49'
      Signature: 278a08ea60d9c1c18b2b6f4f1913860edab3f46bc0945c57e099d37309bab4bbf99feec663d1dc2ef68152baa6e95b0da0e4fdb7793c2c7e779dd7206ad76432f28af41448200c079a9ffe26c8355134d71fb598f08e3864416a1925d5253f2344208a90d8b42790191581c112c3145e23fa979ec06f41cb559ad4e4d60cf549598f3746673c745a3a82e2525c9704adaa59d987ddf6a89641378a558686ca78f920cf1c975508f3943ff6df3aae70f9c5fb1db61134ad5b8d0f455e8483ad250403160b984a4fef6b0baed3cb129c953451c23a4bb9a37c762f286e8bb57049c50c4e06fb17e3fc2e6fcd4dffde6e3ee0ad173b19a9862bae7c921c8976344b
      SignatureAlgorithmOID: 1.2.840.113549.1.1.11
    Signer:
    - SerialNumber: 716ef836a8ceb23aeaf9174e
      Issuer: C=BE, O=GlobalSign nv,sa, CN=GlobalSign Extended Validation CodeSigning
        CA , SHA256 , G3
- Filename: HW.sys
  MD5: 45c2d133d41d2732f3653ed615a745c8
  SHA1: 4e56e0b1d12664c05615c69697a2f5c5d893058a
  SHA256: 6a4875ae86131a594019dec4abd46ac6ba47e57a88287b814d07d929858fe3e5
  Signature: ''
  Date: ''
  Publisher: ''
  Company: Marvin Test Solutions, Inc.
  Description: HW - Windows NT-8 (32/64 bit) kernel mode driver for PC ports/memory/PCI
    access
  Product: HW
  ProductVersion: 4.8.2.0
  FileVersion: 4.8.2.0
  MachineType: AMD64
  OriginalFilename: HW.sys
  Authentihash:
    MD5: 22db74f3f2e50ccdeb471c81e3a62532
    SHA1: 6e87cd3b027a07a810164d618e3f2fce61eb6ec4
    SHA256: 734b74798a680d2e534c14a033858c4081c7879af1f48037d9d5483aa27a7e90
  InternalName: Hw.sys
  Copyright: "Copyright \xA9 1996-2015 Marvin Test Solutions, Inc. All Rights Reserved."
  Imports:
  - ntoskrnl.exe
  - HAL.dll
  ExportedFunctions: ''
  ImportedFunctions:
  - RtlInitUnicodeString
  - RtlAppendUnicodeStringToString
  - ZwClose
  - ZwOpenProcess
  - KeReleaseMutex
  - KeWaitForSingleObject
  - PsGetCurrentProcessId
  - KeInitializeDpc
  - MmGetSystemRoutineAddress
  - IoDeleteDevice
  - IoCreateSymbolicLink
  - KeInitializeMutex
  - IoCreateDevice
  - IoDeleteSymbolicLink
  - PsGetVersion
  - ZwUnmapViewOfSection
  - ZwMapViewOfSection
  - ObReferenceObjectByHandle
  - ZwOpenSection
  - ExFreePoolWithTag
  - MmMapLockedPages
  - MmBuildMdlForNonPagedPool
  - IoAllocateMdl
  - MmMapIoSpace
  - MmUnmapLockedPages
  - MmUnmapIoSpace
  - MmFreeContiguousMemory
  - MmGetPhysicalAddress
  - MmAllocateContiguousMemory
  - IofCallDriver
  - IoBuildSynchronousFsdRequest
  - IoGetDeviceProperty
  - KeInitializeEvent
  - ObfDereferenceObject
  - ExAllocatePoolWithTag
  - ObReferenceObjectByName
  - IoDriverObjectType
  - IofCompleteRequest
  - IoDisconnectInterrupt
  - KeReleaseInterruptSpinLock
  - KeAcquireInterruptSpinLock
  - ExEventObjectType
  - KeFlushQueuedDpcs
  - KeInsertQueueDpc
  - KeSetEvent
  - IoFreeMdl
  - ExAllocatePool
  - HalGetBusDataByOffset
  Signatures:
  - CertificatesInfo: ''
    SignerInfo: ''
    Certificates:
    - Subject: C=BE, O=GlobalSign nv,sa, CN=GlobalSign Timestamping CA , G2
      ValidFrom: '2011-04-13 10:00:00'
      ValidTo: '2028-01-28 12:00:00'
      Signature: 4e5e56901e46b4d94931f3bb1739281bc216ddfd41dc0905049b6fb2a29ad6992e40990055b5ea3fa52076d38634d417cc553ac782eeefa8babcd8069f1550dfcd167b523a02d7191afdaff0785ce04bc518df3a241edaacb8a95804020730dbb0125efe31bef00448f4f070f83a5e5683cf3dfb0dbcf4c5ed979db9d4dba52784e3389b8ba735864420a43b6da46a0ba183fd28ebdaef28f6cc885dfb0a3b00abe021ebe22f356c0f8e344597eba2f79933357ecb9a8abb454de73f9fc2d98afa65b26ec77e65ffe892e12c31a2f7b02736488f266f3bee4d761f79c3e57f9635bc2d0ecc01b08e7fff518080a792d4b34446648c874f166307314b63b0dff3
      SignatureAlgorithmOID: 1.2.840.113549.1.1.5
    - Subject: C=BE, O=GlobalSign nv,sa, CN=GlobalSign CodeSigning CA , G2
      ValidFrom: '2011-04-13 10:00:00'
      ValidTo: '2019-04-13 10:00:00'
      Signature: 225cc5dd3df40b70d8e3f5e7c58e0901bbb196365c5a07adc7a8444951257aae0da4193b929ccfb94226bb3b6c97e7c7ce116d6891da8d6df1534d54388c61f3c8827669be81320b31c36cc99e200a582ff048fe7e4807aad743589473540431a9780d3b8cb070c13d7ed7bd2f2ac3e2f58f0c90dc6ba5c8be685e5d6df878d2be49951e15780891fb34c8be84adbce0c6dd18dbf3caf07bc2143c18b803ba953e211e3f60697a7f6a039e8d4af9f0282c30845eec267242b16dcb64c3128cd6844b67417cb103177809e3ada8b6962da47e80034f88f7c16b5a4615cd2c198bd8709ce52d49886072a8a4195270435edad64603b0680e24ef4af60b2524ef24
      SignatureAlgorithmOID: 1.2.840.113549.1.1.5
    - Subject: C=SG, O=GMO GlobalSign Pte Ltd, CN=GlobalSign TSA for MS Authenticode
        , G2
      ValidFrom: '2015-02-03 00:00:00'
      ValidTo: '2026-03-03 00:00:00'
      Signature: 8032dc078d1ca09c9d3c2ae83d218b59a14d7ecc44ce03be7eaabcc4e67b73bb4bf188da904e7537283863b9d72b0f54a956ce7739973073cd9bd9d905451c8da4b8035d4fd91c2e98e0e988e6ecd7057e562a7bf7165ba3ad8f972512841bb25c634a0ad2ef10544782843569289c0ce41f141624fa75dc74726e4ecae36a43afcf7d3648d1bde906912c2fa6c871fdcfbdd89d2198fcafdbde228cafa7f377ef9ddca3704b441af078851ef2a58c39b5dc881c37edad14f5070b26bdbe6d025eb1b8b0586c853a0df6ff5a270cc5de53e7543c564cc94e4c30f6f25cfb1a8cc282bead5991f61b4d557bcf5b01dcfd7ad36f235c32479b01f3c15114468a9b
      SignatureAlgorithmOID: 1.2.840.113549.1.1.5
    - Subject: C=US, ST=CA, L=Irvine, O=Marvin Test Solutions, Inc., CN=Marvin Test
        Solutions, Inc., emailAddress=it@marvintest.com
      ValidFrom: '2015-06-17 17:46:36'
      ValidTo: '2018-05-04 18:44:13'
      Signature: ab38f2c50cf023223b1fd78c4204cff8fbe1c71ca14bd3dc5d1f7833604526265abcc71a97faae04edf79563c97a75f4587852b1c8cb972771427710112f8fab1c1a01ca13d04301d551ff4c1728798bd5d8e9038ca079a7c1e5fe268f2c87b397bf2038bbee8dabb80be0f2158a468feca435ff9ed8611cf1a7cf0a6756d2defda9934a4c8a6f6dd1577070ca3e6d2ea155f01bae4e0cf05596226810c52e256bf6f7d0632a34bbe3926e083f5eb95bfa614ac331bee378d5a158222731b1edbf1bb3db3915376764e10cffca289cf0478bf9a8e0cf74a85a2a0147aa3ab1b6fb88b69de8c706dc91155126d3b7aaa0fd98b62357a7e30e7c34ef4809009f5d
      SignatureAlgorithmOID: 1.2.840.113549.1.1.5
    - Subject: C=BE, O=GlobalSign nv,sa, OU=Root CA, CN=GlobalSign Root CA
      ValidFrom: '2011-04-15 19:55:08'
      ValidTo: '2021-04-15 20:05:08'
      Signature: 5ff8d065746a81c6a6ca5b03b6914ae84bbdef2ba142f0efb4a5adcd3389ec0b9585ac62501108aa58d25aa08310e5a6337af25af2c5fe787cf09c83df190ad97396002dd62ccde914d41d9de83f3c1a76f7904efb01350a6c9313a0c356eb67a0e4d17a96dec267f190f80a7bf5321b94ec5f751f8d1b34da6c58a7cb2d279e2226b7c9aa30cc0777b836e38201b5393ccc8dd9a75f7f23b3877fdb5798918bd7ce2520e39d644fdd87f72b68490318e0a5df7c5f68644d36838d4781f2e9e0a869abfa7b163c05a449ea8830190a6c73055178dfd41ddd3ad47f2de44e54be83431e7a7433b4a4ebd77073bc2a02988966eef6bc8f749378e329025a5a43e258ce7ccf9acad236893be25fda26054ec8d4e72c910e1797c5beee8b13112323294ffa83d050f6bafad53db3173df4ff034aa325dce67561d1fa35086bd62744d068b78d45e0eb852cc8a15d614474160e5958aed2b5eea5bcd6d7076ab62978fd976767dd8d4f17944fd2ed0caf972437c3a29c81da6be143b6577b4cecbf791319e79fe844e94781b75e701e91f83dd17b27f50b7056434805dda92fab86101d0b12e31ad04c6e75ded645b30b748887935c564a41029af7aeb799d8b67f88fa11f2457cf4d71b91c01cf1a0fbd4080a411a142acef4eb34486e66879ed54b7a397fbb0e3d3861cf735706e412066bd96b5308cd7018c22d4f974691bca9f0
      SignatureAlgorithmOID: 1.2.840.113549.1.1.5
    Signer:
    - SerialNumber: 1121f0942b1e09a2573e8ab9ce0e3955b2de
      Issuer: C=BE, O=GlobalSign nv,sa, CN=GlobalSign CodeSigning CA , G2
Tags:
- hw.sys
